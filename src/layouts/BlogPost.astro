---
import type { CollectionEntry } from 'astro:content';
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import FormattedDate from '../components/FormattedDate.astro';
import BackToTop from '../components/BackToTop.astro';
import '../styles/components/BlogPost.css';
import '../styles/recipes.css';

type Props = CollectionEntry<'blog'>['data'];

const { 
	title, 
	description, 
	pubDate, 
	updatedDate, 
	heroImage,
	readingTime,
	tags,
	category = [],
	subcategory,
	language = ['en'],
	// SEO fields
	canonicalUrl,
	ogImage,
	ogImageAlt,
	robots
} = Astro.props;

const languageEmojis = {
	en: 'üá∫üá∏',
	es: 'üáµüá∑'
};

const categoryEmojis: Record<string, string> = {
	'art-expression': 'üéµ',
	'diy-creation': 'üõ†Ô∏è',
	'integration-growth': 'üßòüèΩ‚Äç‚ôÇÔ∏è',
	'learning-projects': 'üìö',
	'metaspace': 'üåÄ',
	'parenting': 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶',
	'politics': '‚öñÔ∏è',
	'psychology': 'üß†',
	'systems-strategy': 'üíª'
};

const capitalize = (str: string) => str ? str.charAt(0).toUpperCase() + str.slice(1) : '';
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead 
			title={title} 
			description={description} 
			image={heroImage}
			canonicalUrl={canonicalUrl}
			ogImage={ogImage}
			ogImageAlt={ogImageAlt}
			robots={robots}
		/>
	</head>
	<body>
		<Header />
		<main>
			<article>
				<header class="article-header">
					{heroImage && <img width={1020} height={510} src={heroImage} alt="" />}
					<div class="content">
						<div class="metadata">
							<nav class="category-nav" aria-label="Post categories">
								{category.length > 0 && category.map((cat) => (
									<a href={`/categories/${cat.toLowerCase()}/`} class="category-link">
										{categoryEmojis[cat] || 'üìù'} {capitalize(cat)}
										{subcategory && ` / ${capitalize(subcategory)}`}
									</a>
								))}
							</nav>
							<span class="separator">‚Ä¢</span>
							<FormattedDate date={pubDate} />
							{updatedDate && (
								<>
									<span class="separator">‚Ä¢</span>
									<span>Updated <FormattedDate date={updatedDate} /></span>
								</>
							)}
							{readingTime && (
								<>
									<span class="separator">‚Ä¢</span>
									<span>{readingTime} min read</span>
								</>
							)}
							{language.map(lang => (
								<span class="language">{languageEmojis[lang]}</span>
							))}
						</div>
						<h1>{title}</h1>
					</div>
				</header>

				<div class="prose">
					<slot />

					{tags && tags.length > 0 && (
						<div class="tags">
							{tags.map((tag) => (
								<span class="tag">{tag}</span>
							))}
						</div>
					)}
				</div>
			</article>
		</main>
		<Footer />
		<BackToTop />
	</body>
</html>

<style>
	:root {
		/* Light theme colors */
		--background-color: #ffffff;
		--text-color: #1a1a1a;
		--accent-color: #0070f3;
		--secondary-color: #666666;
		--border-color: #eaeaea;
		--code-bg: #f6f8fa;
		--code-text: #24292e;
		--blockquote-bg: #f8f8f8;
		--blockquote-border: #eaeaea;
		--gray: 102, 102, 102;
		--gray-light: 234, 234, 234;
		--black: 26, 26, 26;
		--reading-width: 65ch;
		--line-height: 1.75;
		--letter-spacing: -0.011em;
	}

	.dark {
		--background-color: #111111;
		--text-color: #ffffff;
		--accent-color: #3291ff;
		--secondary-color: #888888;
		--border-color: #333333;
		--code-bg: #1e1e1e;
		--code-text: #d4d4d4;
		--blockquote-bg: #1a1a1a;
		--blockquote-border: #333333;
		--gray: 136, 136, 136;
		--gray-light: 51, 51, 51;
		--black: 255, 255, 255;
	}

	body {
		background-color: var(--background-color);
		color: var(--text-color);
		transition: background-color 0.3s ease, color 0.3s ease;
		line-height: var(--line-height);
		letter-spacing: var(--letter-spacing);
	}

	main {
		min-height: calc(100vh - 200px);
		width: 100%;
		max-width: 100%;
		margin: 0 auto;
		padding: 2rem 1rem;
	}

	.article-header {
		margin-bottom: 4rem;
		max-width: 1400px;
		margin-left: auto;
		margin-right: auto;
	}

	.article-header img {
		width: 100%;
		height: auto;
		border-radius: 12px;
		margin-bottom: 2.5rem;
		box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
	}

	.article-header .content {
		padding: 0 1rem;
		max-width: 800px;
		margin: 0 auto;
	}

	.article-header h1 {
		font-size: 2.75rem;
		line-height: 1.2;
		margin: 1.5rem 0;
		font-weight: 800;
		letter-spacing: -0.025em;
	}

	.metadata {
		display: flex;
		flex-wrap: wrap;
		align-items: center;
		gap: 1rem;
		font-size: 0.9375rem;
		color: rgb(var(--gray));
		margin-bottom: 2rem;
		padding-bottom: 1.5rem;
		border-bottom: 1px solid var(--border-color);
	}

	.category-nav {
		display: inline-block;
		margin-right: 0.5em;
		font-size: 0.9375rem;
		vertical-align: middle;
	}

	.category-link {
		color: rgb(var(--black));
		text-decoration: none;
		font-weight: 600;
		transition: all 0.2s;
		padding: 0.375rem 0.75rem;
		border-radius: 6px;
		background: rgba(var(--gray-light), 0.2);
	}

	.category-link:hover {
		color: var(--accent-color);
		background: rgba(var(--gray-light), 0.3);
		transform: translateY(-1px);
	}

	.separator {
		color: rgb(var(--gray-light));
	}

	.language {
		margin-left: 0.5rem;
	}

	.prose {
		padding: 0 1rem;
		font-size: 1.125rem;
		max-width: 800px;
		margin: 0 auto;
		line-height: 1.8;
	}

	.prose p {
		margin-bottom: 1.75rem;
	}

	.prose h2 {
		font-size: 2rem;
		margin: 3rem 0 1.5rem;
		line-height: 1.3;
		font-weight: 700;
		letter-spacing: -0.02em;
	}

	.prose h3 {
		font-size: 1.5rem;
		margin: 2.5rem 0 1.25rem;
		line-height: 1.3;
		font-weight: 600;
		letter-spacing: -0.015em;
	}

	.tags {
		display: flex;
		flex-wrap: wrap;
		gap: 1rem;
		margin-top: 4rem;
		padding-top: 2.5rem;
		border-top: 1px solid var(--border-color);
	}

	.tag {
		background: rgba(var(--gray-light), 0.2);
		color: rgb(var(--black));
		padding: 0.5rem 1rem;
		border-radius: 1.5rem;
		font-size: 0.875rem;
		font-weight: 500;
		transition: all 0.2s;
	}

	.tag:hover {
		background: rgba(var(--gray-light), 0.3);
		transform: translateY(-1px);
	}

	@media (min-width: 768px) {
		main {
			padding: 4rem 2rem;
		}

		.article-header {
			padding: 0 2rem;
		}

		.article-header .content {
			padding: 0;
		}

		.prose {
			padding: 0;
		}

		.article-header h1 {
			font-size: 3.5rem;
		}

		.metadata {
			font-size: 1rem;
		}
	}

	@media (min-width: 1200px) {
		.article-header {
			padding: 0 4rem;
		}
	}

	@media (max-width: 480px) {
		.article-header h1 {
			font-size: 2.25rem;
		}

		.prose {
			font-size: 1.0625rem;
		}
	}
</style>
